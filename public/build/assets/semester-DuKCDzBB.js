import{r as n,v as Q,j as a,V as m,A as W}from"./app-dtuUTQPg.js";import{B as Y}from"./button-form-Bq4WgXJU.js";import{D as B}from"./date-picker-B1nz7frw.js";import{S as g}from"./select2-BdmNQqEp.js";import{L as h}from"./label-BDJwZ1Pj.js";import{u as Z}from"./useToast-EKkHiayz.js";import{A as aa,B as ea}from"./AuthenticatedLayout-BTyt3L7y.js";import{C as R,a as I,b as $,c as J}from"./card-BA0s0Gic.js";import{S as sa}from"./skeleton-lf6-BL-t.js";import{D as ta}from"./raw-table-BQu-4Mqz.js";import{B as ra,e as la,a as na,R as ia}from"./exportToPdf-Dc0tGEhP.js";import{c as oa,B as D,S as da}from"./button-DPsmANRN.js";import ca from"./update-C0-Wre5s.js";import{S as ma}from"./separator-CjGCVm4I.js";import{D as pa,a as ua,b as ga,d as ha,e as xa,c as U}from"./dropdown-menu-ZSCFBwCD.js";import{p as ja,S as fa}from"./parseISO-wW2OQ_EA.js";import{L as H}from"./loader-circle-DUNaWJrS.js";import{f as x}from"./format-BLGyKstx.js";import{i as j}from"./popover-BzA3x8vr.js";import"./select-CHyngtyH.js";import"./index-ChTBRd0w.js";import"./index-BdQq_4o_.js";import"./index-DG6lS1av.js";import"./index-Cm6O-f5t.js";import"./index-BNtFQH6V.js";import"./Combination-DH0SttvD.js";import"./index-DkKg-NQ3.js";import"./index-D3ZdPiCk.js";import"./index-BO5XnkvU.js";import"./index-DzJ2E_zn.js";import"./chevron-down-WzJ1kcrw.js";import"./check-CwIqQT0W.js";import"./chevron-up-BoLhmJXO.js";import"./calendar-BAPIKp7-.js";import"./chevron-left-KHE4TT5M.js";import"./chevron-right-BPam7CGz.js";import"./calendar-CM2_ZkZB.js";import"./input-Drfy3CFD.js";import"./x-NVNAERGQ.js";import"./index-B4q1E3Zk.js";import"./index-DRbEqTca.js";import"./theme-provider-CW9DNBW8.js";import"./ellipsis-vertical-Cv3G_kEX.js";import"./index-DbTheDnJ.js";import"./table-C01eE_yS.js";import"./badge-BJw2_tMK.js";import"./index-BWkP8tIP.js";function pe({alert:O,kelases:k,semesters:S,auth:d}){var T;Z(O);const{role:w}=d.user,[r,_]=n.useState(),[M,f]=n.useState(!1),[c,G]=n.useState(!1),[v,N]=n.useState({excel:!1,pdf:!1}),[b,A]=n.useState({status:"",jenis_absen:""}),[u,V]=n.useState(""),s=Q({start_date:"",end_date:"",kelas:"",mapel:""}),E=(e,t)=>{V(""),s.setData({...s.data,[e==="start"?"start_date":"end_date"]:t})},q=n.useMemo(()=>[{id:"rowNumber",header:"No.",cell:({row:e})=>{if(!r)return"-";const t=r.current_page-1,l=r.per_page;return t*l+e.index+1}},{accessorKey:"siswa.nis",header:"No Induk",cell:({row:e})=>{var t;return((t=e.original.siswa)==null?void 0:t.nis)??"-"}},{accessorKey:"siswa.nama_lengkap",header:"Nama Siswa",cell:({row:e})=>{var t;return((t=e.original.siswa)==null?void 0:t.nama_lengkap)??"-"}},{accessorKey:"status",header:"Status",cell:({row:e})=>a.jsx(ra,{status:e.original.status})},{accessorKey:"jenis_absen",header:"Jenis Absen"},{accessorKey:"kelas.nama",header:"Kelas",cell:({row:e})=>{var t;return((t=e.original.kelas)==null?void 0:t.nama_kelas)??"-"}},{accessorKey:"tanggal",header:"Tanggal",cell:({row:e})=>x(ja(String(e.original.tanggal)),"EEEE, dd MMMM yyyy",{locale:j})}],[r]),p=n.useCallback(async e=>{var t;if(!s.data.start_date||!s.data.end_date||!s.data.kelas){m.error("Tanggal Mulai, Tanggal Akhir, dan Kelas wajib diisi.");return}f(!0);try{const l=e?{...s.data,page:e}:s.data,o=await window.axios.get(route("laporan.search.semester"),{params:l});o.status===200?_(o.data.data):m.error("Data tidak ditemukan.")}catch(l){l instanceof W&&(_(void 0),m.error(((t=l.response)==null?void 0:t.data.message)??"Terjadi kesalahan!"))}finally{f(!1)}},[s.data]),P=n.useCallback(()=>p(),[p]),z=n.useCallback(e=>p(e),[p]),X=n.useCallback(()=>p(),[p]),L=n.useCallback(async(e,t)=>{const l={...b,[e]:t};if(A(l),!r){m.error("Data belum dimuat");return}f(!0);try{const o=r.data.filter(i=>{const y=!l.status||i.status===l.status,F=!l.jenis_absen||i.jenis_absen===l.jenis_absen;return y&&F});_({...r,data:o})}catch{m.error("Gagal memfilter data")}finally{f(!1)}},[b,r]),K=n.useCallback(async e=>{var l,o;if(!r){m.error("Data masih Kosong!");return}const t=e;N(i=>({...i,[t]:!0}));try{const i=await window.axios.get(route("laporan.export.semester.all"),{params:s.data});if(i.status===200){const y=((l=k.find(C=>String(C.value)===s.data.kelas))==null?void 0:l.label)??"-",F=u?(o=S.find(C=>C.value===u))==null?void 0:o.label:"Custom Range";t==="excel"?la({data:i.data.data,tanggal:`${x(s.data.start_date,"MMMM yyyy",{locale:j})} - ${x(s.data.end_date,"MMMM yyyy",{locale:j})}`,kelas:y,type:"bulanan"}):na({data:i.data.data,tanggal:`${x(s.data.start_date,"MMMM yyyy",{locale:j})} - ${x(s.data.end_date,"MMMM yyyy",{locale:j})}`,kelas:y,typeLaporan:"Bulanan"})}}catch(i){m.error("Gagal mengekspor data"),console.error(`Export ${t.toUpperCase()} error:`,i)}finally{N(i=>({...i,[t]:!1}))}},[r,s.data,k,u,S]);return a.jsxs(aa,{title:"Laporan Semester",children:[a.jsxs(R,{children:[a.jsx(I,{children:a.jsx($,{children:"Cari Data Absensi"})}),a.jsxs(J,{children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Tanggal Mulai"}),a.jsx(B,{date:s.data.start_date,mode:"single",selected:s.data.start_date?new Date(s.data.start_date):void 0,onSelected:e=>E("start",e),placeholder:"Tanggal Mulai",captionLayout:"dropdown"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Tanggal Akhir"}),a.jsx(B,{date:s.data.end_date,mode:"single",selected:s.data.end_date?new Date(s.data.end_date):void 0,onSelected:e=>E("end",e),placeholder:"Tanggal Akhir",captionLayout:"dropdown"})]}),w==="guru"?a.jsxs(a.Fragment,{children:[!d.user.kelas||d.user.kelas.length===0?a.jsx("div",{className:"text-sm text-red-500 italic",children:"Anda belum memiliki kelas"}):a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Pilih Kelas"}),a.jsx(g,{options:[...d.user.kelas.map(e=>({label:e.nama_kelas,value:e.id}))],value:s.data.kelas,onChange:e=>s.setData("kelas",e),searchable:!1,placeholder:"Pilih Kelas"})]}),!d.user.mata_pelajarans||d.user.mata_pelajarans.length===0?a.jsx("div",{className:"text-sm text-red-500 italic",children:"Anda belum memiliki Mata Pelajaran"}):a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Pilih Mata Pelajaran"}),a.jsx(g,{options:[...d.user.mata_pelajarans.map(e=>({label:e.nama_mapel,value:e.id}))],value:s.data.mapel,onChange:e=>s.setData("mapel",e),searchable:!1,placeholder:"Pilih Mata Pelajaran"})]})]}):a.jsxs("div",{className:"space-y-2",children:[a.jsx(h,{children:"Pilih Kelas"}),a.jsx(g,{options:[...k,{label:"Semua Kelas",value:"semua_kelas"}],value:s.data.kelas,onChange:e=>s.setData("kelas",e),searchable:!1,placeholder:"Pilih Kelas"})]})]}),a.jsx("div",{className:"mt-4",children:a.jsx(Y,{label:"Cari Data Absensi",loading:M,onClick:P,type:"button"})})]})]}),M?a.jsx(sa,{className:"h-[300px] w-full rounded-xl mt-4"}):r?a.jsxs(R,{className:"mt-4",children:[a.jsxs(I,{children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 items-center mb-2 gap-4",children:[a.jsxs($,{children:["Hasil Pencarian Absensi",u&&` (${(T=S.find(e=>e.value===u))==null?void 0:T.label})`]}),a.jsxs("div",{className:oa("grid items-center gap-3",c?"grid-cols-1":" grid-cols-2"),children:[a.jsx(D,{onClick:()=>{X(),G(!c)},variant:c?"outline":"default",className:c?"w-fit justify-self-end":"",children:c?"Kembali":a.jsxs(a.Fragment,{children:[a.jsx(fa,{className:"mr-2 h-4 w-4"}),"Edit Data Absen"]})}),!c&&a.jsxs(pa,{children:[a.jsx(ua,{asChild:!0,children:a.jsxs(D,{variant:"outline",children:[a.jsx(ea,{className:"mr-2 h-4 w-4"}),"Export Data"]})}),a.jsxs(ga,{children:[a.jsx(ha,{children:"Export Sebagai"}),a.jsx(xa,{}),a.jsx(U,{onClick:()=>K("pdf"),children:v.pdf?a.jsxs(a.Fragment,{children:[a.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"PDF"}),a.jsx(U,{onClick:()=>K("excel"),children:v.excel?a.jsxs(a.Fragment,{children:[a.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"EXCEL"})]})]})]})]}),a.jsx(ma,{}),a.jsx("h1",{className:"mt-4",children:"Filter Hasil Pencarian"}),a.jsxs("div",{className:"mt-2 grid grid-cols-1 lg:grid-cols-3 gap-2",children:[a.jsx(g,{options:[{label:"Absen Siang",value:"absen_siang"},{label:"Absen Pagi",value:"absen_pagi"}],value:b.jenis_absen,onChange:e=>L("jenis_absen",e),placeholder:"Jenis Absen",searchable:!1}),a.jsx(g,{options:da,value:b.status,onChange:e=>L("status",e),placeholder:"Status Absensi",searchable:!1}),a.jsxs(D,{onClick:()=>{A({jenis_absen:"",status:""}),P()},children:[a.jsx(ia,{className:"mr-2 h-4 w-4"}),"Reset Filter"]})]})]}),a.jsx(J,{children:c?a.jsx(ca,{dataSiswa:r,role:w}):a.jsx(ta,{columns:q,data:r.data,links:r.links,path:"laporan.search.semester",current_page:r.current_page,per_page:r.per_page,last_page:r.last_page,total:r.total,isJson:!0,handlePageChange:z})})]}):null]})}export{pe as default};
