import{r as i,v,V as s,j as t,m as M}from"./app-D-pvG-h7.js";import{A as C}from"./AuthenticatedLayout-WKkpFzN6.js";import{u as K}from"./useToast-CczIibfT.js";import{B as h}from"./button-form-DPrc8m5f.js";import T from"./AttachSiswaToMapel-t_sp-N7I.js";import I from"./ManageSiswaGroup-DS727ArU.js";import{SearchForm as N}from"./SearchForm-CgwQFqxq.js";import{A as L}from"./arrow-left-CaKg1H8K.js";import{a as V}from"./button-DDrB44aA.js";import"./input-BqtjLy8Q.js";import"./separator-jC85Eame.js";import"./index-BCDtQqrj.js";import"./index-DfVJz2yI.js";import"./index-DPWi2SFl.js";import"./index-B_qB3y_n.js";import"./Combination-DkhTlgzF.js";import"./index-CbbB-d8s.js";import"./x-CbMpTP9X.js";import"./skeleton-ChprEDY9.js";import"./theme-provider-CJsZ6qwK.js";import"./index-Cv54-QBM.js";import"./index-pc8TUt6X.js";import"./index-j9pfCE30.js";import"./chevron-right-CvAe3Q1P.js";import"./dropdown-menu-BYgId_-S.js";import"./index-C4kcJLGa.js";import"./index-BsxPpjHb.js";import"./check-Dl2Q0njl.js";import"./ellipsis-vertical-Df7DsWCi.js";import"./index-DB_nWd7P.js";import"./loader-circle-DcNhUuUm.js";import"./card-PWHeHM1M.js";import"./SiswaTable-CUSa0P6v.js";import"./raw-table-BJKsIAkD.js";import"./table-uyHhqeUw.js";import"./chevron-left-CODoTmto.js";import"./checkbox-6ZREB3Ee.js";import"./index-DV9RjSlp.js";import"./tabs-9ZUMunnI.js";import"./index-BdQq_4o_.js";import"./KelasTabContent-DoXkA2OV.js";import"./select2-CLGfsiw0.js";import"./select-DeUrfpU1.js";import"./chevron-down-DT_wD1pv.js";import"./chevron-up-DDtDRMKX.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],H=V("save",z);function Ca({alert:w,kelases:g,mapels:_,guru_id:l,auth:o}){K(w);const[d,f]=i.useState(),[k,u]=i.useState(!1),[x,b]=i.useState({}),[n,S]=i.useState([]),e=v({id_kelas:"",id_mapel:""}),m=i.useCallback(async()=>{if(!e.data.id_mapel||!e.data.id_kelas){s.error("Mapel & Kelas harus diisi!");return}u(!0);try{const a=await window.axios.get(route("user.get.detailguru",l),{params:{mapel_id:e.data.id_mapel}});a.status===200&&f(a.data.data)}catch(a){console.error("Gagal mengambil detail guru:",a),s.error("Gagal mengambil data guru")}finally{u(!1)}},[e.data,l]),y=i.useCallback(async()=>{if(!e.data.id_kelas||!e.data.id_mapel||!n.length){s.error("Harap pilih kelas, mapel, dan setidaknya satu siswa");return}try{const a=await window.axios.post(route("user.siswa.attach"),{mapel_id:e.data.id_mapel,siswa_ids:n,kelas_id:e.data.id_kelas,user_id:o.user.role==="super-admin"?l:o.user.id});a.status===200&&(s.success(a.data.message),await m())}catch(a){console.error("Gagal menambahkan siswa:",a),s.error("Gagal menambahkan siswa ke mapel")}},[e.data,n,m]),G=i.useCallback(async(a,p)=>{try{const r=p?"user.siswa.attach":"user.siswa.detach",c=await window.axios.post(route(r),{siswa_ids:[a.siswa_id],mapel_id:a.mapel_id,user_id:o.user.role==="super-admin"?l:o.user.id});c.data.success?(s.success(c.data.message),b(D=>({...D,[`${a.siswa_id}-${a.mapel_id}`]:p}))):s.error(c.data.message||"Operasi gagal")}catch(r){console.error("Gagal mengubah status siswa:",r),s.error("Terjadi kesalahan server")}},[o.user.id]),j=i.useCallback(async(a,p)=>{try{const r=await window.axios.post(route("user.siswa.detach"),{mapel_id:a.mapel_id,siswa_ids:p,user_id:o.user.role==="super-admin"?l:o.user.id});r.data.success&&(s.success(r.data.message),await m())}catch(r){console.error("Gagal menghapus siswa:",r),s.error("Gagal menghapus siswa")}},[m]),A=d&&Object.keys(d.siswa_grouped).length>0;return t.jsxs(C,{title:"Kelola Siswa",children:[t.jsxs("div",{className:"flex items-center gap-3 self-end mb-4",children:[t.jsx(h,{label:"Kembali",lefticon:t.jsx(L,{size:16}),onClick:()=>M.get(route("user.index")),variant:"outline"}),t.jsx(h,{label:"Simpan",righticon:t.jsx(H,{size:16}),onClick:y})]}),t.jsx(N,{kelases:g,mapels:_,form:e,loading:k,onSearch:m}),d?A?t.jsx(I,{siswaGrouped:d.siswa_grouped,attachedSiswa:x,onAttachDetach:G,onDetachAllInKelas:j}):t.jsx(T,{id_kelas:Number(e.data.id_kelas),id_mapel:Number(e.data.id_mapel),returnData:S}):null]})}export{Ca as default};
