import{r as j,j as a,v as V,A as U,V as N}from"./app-DI_7iOGi.js";import{D as Y}from"./date-picker-CtQ481_-.js";import{C as M,a as O,b as $,c as F}from"./card-CRDQ6-HN.js";import{A as L}from"./AuthenticatedLayout-CJzY5Xrb.js";import{S as k}from"./select2-CLxBKvX1.js";import{L as g}from"./label-C8nOiwIa.js";import{T as q,a as Q,b as W,c as B,d as v,e as X,f as _}from"./table-DEct_Vxi.js";import{B as T}from"./button-form-CVGmifLz.js";import{S as Z}from"./skeleton-CxGvy62n.js";import aa from"./AttachMapelToSiswa-BtFTgTQa.js";import{u as ea}from"./useToast-C-22vdO3.js";import{H as sa}from"./theme-provider-BsdHpEmu.js";import{A as la}from"./arrow-left-DaKwZu_C.js";import{S as y}from"./send-horizontal-CHOo8Db2.js";import"./select-OucRZLGt.js";import"./index-BGoB9TCs.js";import"./button-ouBvtTzt.js";import"./index-BdQq_4o_.js";import"./index-D1FKjugl.js";import"./index-ByiadMdx.js";import"./index-D7g85S3M.js";import"./Combination-KH8HP5zT.js";import"./index-Bh9eaD_H.js";import"./index-BlJ1_0NA.js";import"./index-DUUlX3oA.js";import"./index-1PqMr3ZH.js";import"./chevron-down-BACfvzZf.js";import"./check-5dKJEGSP.js";import"./chevron-up-SZJPr3au.js";import"./calendar-dScWqO6w.js";import"./chevron-left-S_yJJYGT.js";import"./chevron-right-zboEp8pf.js";import"./popover-DrGsn9f6.js";import"./format-BLGyKstx.js";import"./index-CwrRQkFr.js";import"./calendar-BhOEQ5AK.js";import"./input-C3dI5ERP.js";import"./separator-DUHQMWeJ.js";import"./index-D9_RKr1o.js";import"./x-qbxLeAft.js";import"./dropdown-menu-CzyrIVSs.js";import"./index-BE85i_lL.js";import"./ellipsis-vertical-Bfx82VKo.js";import"./index-DoI55BCK.js";import"./loader-circle-BntIrtio.js";import"./raw-table-DW9omX-9.js";import"./checkbox-mF7iQ_c0.js";const R=[{label:"Hadir",value:"hadir"},{label:"Alpa",value:"alpa"},{label:"Izin",value:"izin"},{label:"Sakit",value:"sakit"}],ta=(c,d)=>{const s=V(c),[h,n]=j.useState(),[e,i]=j.useState(!1),[S,t]=j.useState(!1),p=new URLSearchParams(window.location.search);j.useEffect(()=>{!s.data.tanggal&&p.get("tanggal")?s.setData("tanggal",decodeURIComponent(p.get("tanggal")??"")):s.setData("tanggal",new Date().toISOString().split("T")[0]),!s.data.kelas&&p.get("kelas_id")&&s.setData("kelas",decodeURIComponent(p.get("kelas_id")??"")),!s.data.mapel&&p.get("mapel_id")&&s.setData("mapel",decodeURIComponent(p.get("mapel_id")??"")),p.has("mapel_id")&&p.has("kelas_id")&&m(decodeURIComponent(p.get("kelas_id")??""),decodeURIComponent(p.get("mapel_id")??""))},[]);const m=j.useCallback(async(r,f)=>{var x,w;i(!0);try{const b=await window.axios.get(route("absensi.search.siswa",{kelas:r,mapel:f}));b.status===200&&n(b.data.data)}catch(b){b instanceof U&&((x=b.response)==null?void 0:x.status)===422?N.error(((w=b.response.data)==null?void 0:w.message)??"Kode Kelas Tidak Sah"):N.error("Terjadi kesalahan saat mengambil data siswa")}finally{i(!1)}},[]),P=j.useCallback((r,f)=>{const x=s.data.selected_siswa.filter(w=>w.id_siswa!==r);x.push({id_siswa:r,status_absen:f}),s.setData("selected_siswa",x)},[s]),l=j.useCallback(r=>{s.setData("kelas",r),(d==="super-admin"||s.data.mapel)&&m(r,s.data.mapel)},[s,m,d]),u=j.useCallback(r=>{s.setData("mapel",r),(d==="super-admin"||s.data.kelas)&&m(s.data.kelas,r)},[s,m,d]);return{form:s,dataSiswa:h,loadingSearchSiswa:e,attachMapelToSiswaScreen:S,setAttachMapelToSiswaScreen:t,handleGetDataSiswa:m,handleStatusChange:P,handleKelasChange:l,handleMapelChange:u}},ia=({dataSiswa:c,form:d,handleStatusChange:s,selectedKelas:h,role:n})=>a.jsx(M,{className:"mt-4",children:a.jsx(F,{className:"mt-3",children:a.jsx("div",{className:"relative max-h-[300px] overflow-auto rounded border",children:a.jsxs(q,{children:[a.jsxs(Q,{children:["Total Siswa Kelas ",(h==null?void 0:h.label)??"-"," -"," ",c.length," Siswa"]}),a.jsx(W,{children:a.jsxs(B,{className:"sticky top-0 z-50 bg-background shadow border",children:[a.jsx(v,{className:"w-[5%]",children:"Urut"}),a.jsx(v,{className:"w-[100px]",children:"No Induk"}),a.jsx(v,{className:"text-center",children:"Nama"}),a.jsx(v,{className:"w-[10%]",children:"L/P"}),a.jsx(v,{children:"Jurusan"}),a.jsx(v,{children:"Status"})]})}),a.jsx(X,{children:c.map((e,i)=>a.jsx(na,{index:i,siswa:e,handleStatusChange:s,form:d,role:n},e.id))})]})})})}),na=({role:c,handleStatusChange:d,siswa:s,form:h,index:n})=>{var e;return a.jsxs(B,{children:[a.jsx(_,{children:n+1}),a.jsx(_,{children:s.nis}),a.jsx(_,{children:s.nama_lengkap}),a.jsx(_,{children:s.jenis_kelamin||"-"}),a.jsx(_,{children:s.jurusan}),a.jsx(_,{children:a.jsx(k,{options:c==="super-admin"?[...R,{label:"Telat",value:"telat"}]:R,onChange:i=>d(s.id.toString(),i),value:((e=h.data.selected_siswa.find(i=>i.id_siswa===String(s.id)))==null?void 0:e.status_absen)||"",searchable:!1,placeholder:"Pilih Status Kehadiran Siswa"})})]})},ra=({role:c,kelases:d,mapels:s,users:h,guruData:n,form:e,handleKelasChange:i,handleMapelChange:S})=>a.jsx(M,{children:a.jsxs(F,{className:"mt-3 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Tanggal Absensi"}),a.jsx(Y,{date:e.data.tanggal,mode:"single",selected:new Date(e.data.tanggal),onSelected:t=>e.setData("tanggal",t),placeholder:"Masukan Tanggal Absensi",todayAction:()=>e.setData("tanggal",new Date().toString()),captionLayout:"dropdown"})]}),c==="super-admin"||c==="bk"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Kelas"}),a.jsx(k,{options:d,value:e.data.kelas,onChange:i,placeholder:"Pilih Kelas"}),e.errors.kelas&&a.jsx("span",{className:"text-red-500",children:e.errors.kelas})]}),a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Mata pelajaran"}),a.jsx(k,{options:[{label:"Keseluruhan",value:"keseluruhan"},...s],value:e.data.mapel,onChange:S,placeholder:"Pilih Mata Pelajaran"})]}),!["bk","guru"].includes(c)&&a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Guru Pengajar"}),a.jsx(k,{options:h,value:e.data.user_id,onChange:t=>e.setData("user_id",t),placeholder:"Pilih Guru Pengajar"})]}),a.jsxs("div",{className:"col-span-full",children:[a.jsx(g,{children:"Pilih Jenis Absensi"}),a.jsx(k,{options:[{label:"Keseluruhan",value:"keseluruhan"},{label:"Absen Pagi",value:"absen_pagi"},{label:"Absen Siang",value:"absen_siang"}],value:e.data.jenis_absen,onChange:t=>e.setData("jenis_absen",t),placeholder:"Pilih Jenis Absensi",searchable:!1})]})]}):a.jsxs(a.Fragment,{children:[n.kelas&&n.kelas.length===0?a.jsx("div",{className:"text-red-500",children:"Anda Belum Memiliki Kelas Yang Di Ampu!"}):a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Kelas"}),a.jsx(k,{options:n.kelas&&n.kelas.map(t=>({label:t.nama_kelas,value:t.id})),value:e.data.kelas,onChange:i,placeholder:"Pilih Kelas"}),e.errors.kelas&&a.jsx("span",{className:"text-red-500",children:e.errors.kelas})]}),n.kelas.length===0?a.jsx("div",{className:"text-red-500",children:"Anda Belum Memiliki Mata Pelajaran Yang Di Ampu!"}):a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Mata Pelajaran"}),a.jsx(k,{options:n.mata_pelajarans.map(t=>({label:t.nama_mapel,value:t.id})),value:e.data.mapel,onChange:S,placeholder:"Pilih Mata Pelajaran"}),e.errors.mapel&&a.jsx("span",{className:"text-red-500",children:e.errors.mapel})]}),a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Jenis Absensi"}),a.jsx(k,{options:[{label:"Keseluruhan",value:"keseluruhan"},{label:"Absen Pagi",value:"absen_pagi"},{label:"Absen Siang",value:"absen_siang"}],value:e.data.jenis_absen,onChange:t=>e.setData("jenis_absen",t),placeholder:"Pilih Jenis Absensi",searchable:!1})]})]})]})});function ee({alert:c,kelases:d,mapels:s,auth:h,users:n,guruData:e}){var I;ea(c);const{role:i}=h.user,[S,t]=j.useState([]),[p,m]=j.useState(!1),P={tanggal:"",kelas:"",mapel:"",jenis_absen:"",selected_siswa:[],user_id:""},{form:l,dataSiswa:u,loadingSearchSiswa:r,attachMapelToSiswaScreen:f,setAttachMapelToSiswaScreen:x,handleStatusChange:w,handleKelasChange:b,handleMapelChange:H,handleGetDataSiswa:z}=ta(P,i),J=o=>{o.preventDefault(),l.post(route("absensi.store"))},E=async()=>{var D;const o=l.data.kelas!=="",A=l.data.mapel!=="";if(!o||!A&&!S){N.error("Kode Kelas Atau Kode Mapel Tidak Sah! ");return}m(!0);try{const C=await window.axios.post(route("absensi.attachSiswa"),{mapel_id:l.data.mapel,siswa_ids:S,kelas_id:l.data.kelas});C.status===200&&(N.success(C.data.message),await z(l.data.kelas,l.data.mapel))}catch(C){if(C instanceof U){N.error(((D=C.response)==null?void 0:D.data.message)??"Terjadi Kesalahan!");return}}finally{m(!1)}},G=()=>{const o=l.data.kelas!=="",A=l.data.mapel!=="";return!o&&!A&&!u?null:o&&A&&u&&u.length===0?f?a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx(T,{label:"Kembali",lefticon:a.jsx(la,{}),type:"button",onClick:()=>x(!1),variant:"outline"}),a.jsx(T,{label:"Tambah Siswa Ke Mapel",righticon:a.jsx(y,{}),type:"button",onClick:E,loading:p})]}):a.jsx("div",{className:"flex justify-end",children:a.jsx(T,{label:"Input Data Siswa",righticon:a.jsx(y,{}),type:"button",onClick:()=>x(!0)})}):o&&A&&u&&u.length>0?a.jsx("div",{className:"flex justify-end",children:a.jsx(T,{label:"Simpan Data Absensi",righticon:a.jsx(y,{}),type:"submit",loading:l.processing})}):null},K=(I=s.find(o=>String(o.value)===l.data.mapel))==null?void 0:I.label;return e.kelas&&e.kelas.length===0&&e.mata_pelajarans&&e.mata_pelajarans.length===0&&!["super-admin","bk"].includes(e.role)?a.jsx(L,{title:"Absensi",children:a.jsxs("div",{className:"flex flex-col justify-center items-center space-y-3",children:[a.jsx("div",{className:"p-4 border-red-600 rounded-full border-2 justify-center items-center flex",children:a.jsx(sa,{className:"text-red-500",size:42})}),a.jsx("p",{className:"text-red-500",children:"*Silahkan hubungi staff TU atau Admin, Untuk aktivasi kelas dan mata pelajaran!"})]})}):a.jsx(L,{title:"Absensi",children:a.jsxs("form",{onSubmit:J,className:"grid grid-cols-1 gap-3",children:[a.jsx(ra,{role:i,kelases:d,mapels:s,users:n,guruData:e,form:l,handleKelasChange:b,handleMapelChange:H}),r?a.jsx("div",{className:"flex items-center justify-center",children:a.jsx(Z,{className:"h-[300px] w-full rounded-xl"})}):u&&u.length>0?a.jsx(ia,{dataSiswa:u,form:l,handleStatusChange:w,selectedKelas:d.find(o=>String(o.value)===l.data.kelas),role:i}):f?a.jsx(aa,{id_kelas:Number(l.data.kelas),id_mapel:Number(l.data.mapel),returnData:o=>t(o)}):e.kelas&&e.kelas.length===0&&e.mata_pelajarans&&e.mata_pelajarans.length===0?null:a.jsx(M,{children:a.jsx(O,{className:"my-2",children:a.jsx($,{className:"text-center text-red-500",children:e&&K?`Belum Ada Siswa Di Mata Pelajaran ${K} Ini`:"Silakan pilih kelas dan mata pelajaran terlebih dahulu"})})}),G()]})})}export{ee as default};
