import{r as i,v,V as s,j as t,m as M}from"./app-Be7wcuig.js";import{A as C}from"./AuthenticatedLayout-DCUJhVTg.js";import{u as K}from"./useToast-CuLHTejM.js";import{B as h}from"./button-form-DebyDqFA.js";import T from"./AttachSiswaToMapel-7EQZaRoB.js";import I from"./ManageSiswaGroup-Bli7EK_D.js";import{SearchForm as N}from"./SearchForm-C8DqmCLQ.js";import{A as L}from"./arrow-left-fGmrFb59.js";import{a as V}from"./button-D21nJUxp.js";import"./input-tt0-goEF.js";import"./separator-Cpyy9FVL.js";import"./index-WTp1D-hs.js";import"./index-BhD_z2U8.js";import"./index-BurpsiO2.js";import"./index-BFTRfg0n.js";import"./Combination-CtllgFTn.js";import"./index-D5mnyflg.js";import"./x-GC_VB4KH.js";import"./skeleton-eP3pHbec.js";import"./theme-provider-BPAdqLdU.js";import"./index-DqMWcGP6.js";import"./index-DB97RmjF.js";import"./index-CCHQAEz3.js";import"./chevron-right-YNqigzbs.js";import"./dropdown-menu-BZ4A-8kV.js";import"./index-TKIuJNvt.js";import"./index-CKkIvy73.js";import"./check-DtOHl60z.js";import"./ellipsis-vertical-DKfn1mXT.js";import"./index-Cz4MWCIK.js";import"./loader-circle-BzVBFR4d.js";import"./card-Cwodzru-.js";import"./SiswaTable-BwYQr1XK.js";import"./raw-table-DPLPpNqa.js";import"./table-CRAXoSS_.js";import"./chevron-left-CJI9V-Tq.js";import"./checkbox-KTrbZycv.js";import"./index-Dh-dY0qt.js";import"./tabs-vLtXeLXA.js";import"./index-BdQq_4o_.js";import"./KelasTabContent-DNRbesWG.js";import"./select2-CKDza7Xp.js";import"./select-BQyDqewk.js";import"./chevron-down-Dy_RuLg-.js";import"./chevron-up-BmzESFsw.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],H=V("save",z);function Ca({alert:w,kelases:g,mapels:_,guru_id:l,auth:o}){K(w);const[d,f]=i.useState(),[k,u]=i.useState(!1),[x,b]=i.useState({}),[n,S]=i.useState([]),e=v({id_kelas:"",id_mapel:""}),m=i.useCallback(async()=>{if(!e.data.id_mapel||!e.data.id_kelas){s.error("Mapel & Kelas harus diisi!");return}u(!0);try{const a=await window.axios.get(route("user.get.detailguru",l),{params:{mapel_id:e.data.id_mapel}});a.status===200&&f(a.data.data)}catch(a){console.error("Gagal mengambil detail guru:",a),s.error("Gagal mengambil data guru")}finally{u(!1)}},[e.data,l]),y=i.useCallback(async()=>{if(!e.data.id_kelas||!e.data.id_mapel||!n.length){s.error("Harap pilih kelas, mapel, dan setidaknya satu siswa");return}try{const a=await window.axios.post(route("user.siswa.attach"),{mapel_id:e.data.id_mapel,siswa_ids:n,kelas_id:e.data.id_kelas,user_id:o.user.role==="super-admin"?l:o.user.id});a.status===200&&(s.success(a.data.message),await m())}catch(a){console.error("Gagal menambahkan siswa:",a),s.error("Gagal menambahkan siswa ke mapel")}},[e.data,n,m]),G=i.useCallback(async(a,p)=>{try{const r=p?"user.siswa.attach":"user.siswa.detach",c=await window.axios.post(route(r),{siswa_ids:[a.siswa_id],mapel_id:a.mapel_id,user_id:o.user.role==="super-admin"?l:o.user.id});c.data.success?(s.success(c.data.message),b(D=>({...D,[`${a.siswa_id}-${a.mapel_id}`]:p}))):s.error(c.data.message||"Operasi gagal")}catch(r){console.error("Gagal mengubah status siswa:",r),s.error("Terjadi kesalahan server")}},[o.user.id]),j=i.useCallback(async(a,p)=>{try{const r=await window.axios.post(route("user.siswa.detach"),{mapel_id:a.mapel_id,siswa_ids:p,user_id:o.user.role==="super-admin"?l:o.user.id});r.data.success&&(s.success(r.data.message),await m())}catch(r){console.error("Gagal menghapus siswa:",r),s.error("Gagal menghapus siswa")}},[m]),A=d&&Object.keys(d.siswa_grouped).length>0;return t.jsxs(C,{title:"Kelola Siswa",children:[t.jsxs("div",{className:"flex items-center gap-3 self-end mb-4",children:[t.jsx(h,{label:"Kembali",lefticon:t.jsx(L,{size:16}),onClick:()=>M.get(route("user.index")),variant:"outline"}),t.jsx(h,{label:"Simpan",righticon:t.jsx(H,{size:16}),onClick:y})]}),t.jsx(N,{kelases:g,mapels:_,form:e,loading:k,onSearch:m}),d?A?t.jsx(I,{siswaGrouped:d.siswa_grouped,attachedSiswa:x,onAttachDetach:G,onDetachAllInKelas:j}):t.jsx(T,{id_kelas:Number(e.data.id_kelas),id_mapel:Number(e.data.id_mapel),returnData:S}):null]})}export{Ca as default};
