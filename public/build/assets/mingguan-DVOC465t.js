import{r as c,j as a,v as J,V as j,A as U}from"./app-C9tQhv_Z.js";import{B as G}from"./button-form-CWe0OB07.js";import{S as C}from"./select2-Ilo9BMIQ.js";import{u as V}from"./useToast-Cw97dzwI.js";import{A as q,B as z}from"./AuthenticatedLayout-ChHh_5dT.js";import{C as O,a as P,b as F,c as K}from"./card-DShkTWeU.js";import{S as X}from"./skeleton-CbZi3YVn.js";import{D as Q}from"./raw-table-IFDfld6q.js";import{B as Y,e as Z,a as aa,R as ea}from"./exportToPdf-BsbOCYED.js";import{B as w,c as sa,S as ta}from"./button-CJTtMwL8.js";import ra from"./update-DHbmup35.js";import{S as na}from"./separator-DZph8esR.js";import{D as la,a as oa,b as ia,d as ca,e as da,c as L}from"./dropdown-menu-Byz9-lBz.js";import{P as ma,a as pa,b as ga,i as m}from"./popover-EextctjQ.js";import{C as ua}from"./calendar-BCXyCexV.js";import{g as xa,t as ha,s as T,f as g}from"./format-BLGyKstx.js";import{C as fa}from"./calendar-D2wCRpjd.js";import{p as ja,S as ya}from"./parseISO-D-ASdxQl.js";import{L as B}from"./loader-circle-CVDOjECe.js";import"./select-ObIq_07B.js";import"./index-CQA42a1l.js";import"./index-BdQq_4o_.js";import"./index-C5g0trgJ.js";import"./index-CwGbMlpu.js";import"./index-DFBKEqHs.js";import"./Combination-BC-g0I6C.js";import"./index-BTkG7Wq1.js";import"./index-af218OiE.js";import"./index-DV3kUubK.js";import"./index-lqNe-Rya.js";import"./chevron-down-DThK4zKl.js";import"./check-BZ89noGP.js";import"./chevron-up-DrQ2uUfL.js";import"./input-C6ZwSnPh.js";import"./x-C1UzyEuZ.js";import"./index-SJC72_OY.js";import"./index-DRMvO1dW.js";import"./theme-provider-B-DTGj4I.js";import"./chevron-right-CNF1v_CZ.js";import"./ellipsis-vertical-B6lyN1bf.js";import"./index-bfOGIxVS.js";import"./table-CCp73HfD.js";import"./chevron-left-mLpkzFX_.js";import"./badge-CLQ4L_A7.js";import"./index-DiYJPi1s.js";function $(k,i){var p,r,y,f;const x=xa(),d=(i==null?void 0:i.weekStartsOn)??((r=(p=i==null?void 0:i.locale)==null?void 0:p.options)==null?void 0:r.weekStartsOn)??x.weekStartsOn??((f=(y=x.locale)==null?void 0:y.options)==null?void 0:f.weekStartsOn)??0,s=ha(k),u=s.getDay(),h=(u<d?-7:0)+6-(u-d);return s.setDate(s.getDate()+h),s.setHours(23,59,59,999),s}function ba({value:k,onChange:i,label:x=""}){const[d,s]=c.useState(k),u=d?T(d,{weekStartsOn:1}):null,h=d?$(d,{weekStartsOn:1}):null,p=u&&h?`${g(u,"dd MMMM",{locale:m})} - ${g(h,"dd MMMM yyyy",{locale:m})}`:"";return a.jsxs("div",{className:"flex flex-col space-y-1.5",children:[x&&a.jsx("span",{className:"text-sm font-medium",children:x}),a.jsxs(ma,{children:[a.jsx(pa,{asChild:!0,children:a.jsxs(w,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[a.jsx(fa,{className:"mr-2 h-4 w-4"}),p||a.jsx("span",{children:"Pilih minggu"})]})}),a.jsx(ga,{className:"w-auto p-0",align:"start",children:a.jsx(ua,{lang:"id",locale:m,mode:"single",selected:d,onSelect:r=>{if(!r)return;s(r);const y=T(r,{weekStartsOn:1}),f=$(r,{weekStartsOn:1});i==null||i({start:y,end:f})}})})]})]})}function pe({alert:k,kelases:i,auth:x}){V(k);const{role:d}=x.user,[s,u]=c.useState(),[h,p]=c.useState(!1),[r,y]=c.useState(!1),[f,N]=c.useState({excel:!1,pdf:!1}),[M,_]=c.useState({status:"",jenis_absen:""}),n=J({tanggal:{start:"",end:""},kelas:""}),R=c.useMemo(()=>[{id:"rowNumber",header:"No.",cell:({row:e})=>{if(!s)return"-";const t=s.current_page-1,l=s.per_page;return t*l+e.index+1}},{accessorKey:"siswa.nis",header:"No Induk",cell:({row:e})=>{var t;return((t=e.original.siswa)==null?void 0:t.nis)??"-"}},{accessorKey:"siswa.nama_lengkap",header:"Nama Siswa",cell:({row:e})=>{var t;return((t=e.original.siswa)==null?void 0:t.nama_lengkap)??"-"}},{accessorKey:"status",header:"Status",cell:({row:e})=>a.jsx(Y,{status:e.original.status})},{accessorKey:"jenis_absen",header:"Jenis Absen"},{accessorKey:"kelas.nama",header:"Kelas",cell:({row:e})=>{var t;return((t=e.original.kelas)==null?void 0:t.nama_kelas)??"-"}},{accessorKey:"tanggal",header:"Tanggal",cell:({row:e})=>g(ja(String(e.original.tanggal)),"EEEE, dd MMMM yyyy",{locale:m})}],[s]),b=c.useCallback(async e=>{var t;if(!n.data.tanggal||!n.data.kelas){j.error("Tanggal dan Kelas wajib diisi.");return}p(!0);try{const l=e?{...n.data,page:e}:n.data,o=await window.axios.get(route("laporan.search.mingguan"),{params:l});o.status===200?u(o.data.data):j.error("Data tidak ditemukan.")}catch(l){l instanceof U&&j.error(((t=l.response)==null?void 0:t.data.message)??"Terjadi kesalahan!")}finally{p(!1)}},[n.data]),v=c.useCallback(()=>b(),[b]),I=c.useCallback(e=>b(e),[b]),W=c.useCallback(()=>b(),[b]),E=c.useCallback(async(e,t)=>{const l={...M,[e]:t};if(_(l),!s){j.error("Data belum dimuat");return}p(!0);try{const o=s.data.filter(S=>{const D=!l.status||S.status===l.status,H=!l.jenis_absen||S.jenis_absen===l.jenis_absen;return D&&H});u({...s,data:o})}catch{j.error("Gagal memfilter data")}finally{p(!1)}},[M,s]),A=c.useCallback(async e=>{var l;if(!s){j.error("Data masih Kosong!");return}const t=e;N(o=>({...o,[t]:!0}));try{const o=await window.axios.get(route("laporan.export.mingguan.all"),{params:n.data});if(o.status===200){const S=((l=i.find(D=>String(D.value)===n.data.kelas))==null?void 0:l.label)??"-";t==="excel"?Z({data:o.data.data,tanggal:`${g(n.data.tanggal.start,"dd MMMM",{locale:m})} - ${g(n.data.tanggal.end,"dd MMMM yyyy",{locale:m})}`,kelas:S,type:"mingguan"}):aa({data:o.data.data,tanggal:`${g(n.data.tanggal.start,"dd MMMM",{locale:m})} - ${g(n.data.tanggal.end,"dd MMMM yyyy",{locale:m})}`,kelas:S,typeLaporan:"Mingguan"})}}catch(o){j.error("Gagal mengekspor data"),console.error(`Export ${t.toUpperCase()} error:`,o)}finally{N(o=>({...o,[t]:!1}))}},[s,n.data,i]);return a.jsxs(q,{title:"Laporan Mingguan",children:[a.jsxs(O,{children:[a.jsx(P,{children:a.jsx(F,{children:"Cari Data Absensi"})}),a.jsx(K,{children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[a.jsx(ba,{onChange:({end:e,start:t})=>n.setData("tanggal",{start:g(t,"yyyy-MM-dd",{locale:m}),end:g(e,"yyyy-MM-dd",{locale:m})})}),a.jsx(C,{options:[...i,{label:"Semua Kelas",value:"semua_kelas"}],value:n.data.kelas,onChange:e=>n.setData("kelas",e),searchable:!1,placeholder:"Pilih Kelas"}),a.jsx(G,{label:"Cari Data Absensi",loading:h,onClick:v,type:"button"})]})})]}),h?a.jsx(X,{className:"h-[300px] w-full rounded-xl mt-4"}):s?a.jsxs(O,{className:"mt-4",children:[a.jsxs(P,{children:[a.jsxs("div",{className:"grid grid-cols-2 items-center mb-2",children:[a.jsx(F,{children:"Hasil Pencarian Absensi"}),a.jsxs("div",{className:sa("grid items-center gap-3",r?"grid-cols-1":" grid-cols-2"),children:[d!=="guru"&&a.jsx(w,{onClick:()=>{W(),y(!r)},variant:r?"outline":"default",className:r?"w-fit justify-self-end":"",children:r?"Kembali":a.jsxs(a.Fragment,{children:[a.jsx(ya,{className:"mr-2 h-4 w-4"}),"Edit Data Absen"]})}),!r&&a.jsxs(la,{children:[a.jsx(oa,{asChild:!0,children:a.jsxs(w,{variant:"outline",children:[a.jsx(z,{className:"mr-2 h-4 w-4"}),"Export Data"]})}),a.jsxs(ia,{children:[a.jsx(ca,{children:"Export Sebagai"}),a.jsx(da,{}),a.jsx(L,{onClick:()=>A("pdf"),children:f.pdf?a.jsxs(a.Fragment,{children:[a.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"PDF"}),a.jsx(L,{onClick:()=>A("excel"),children:f.excel?a.jsxs(a.Fragment,{children:[a.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"EXCEL"})]})]})]})]}),a.jsx(na,{}),a.jsx("h1",{className:"mt-4",children:"Filter Hasil Pencarian"}),a.jsxs("div",{className:"mt-2 grid grid-cols-1 lg:grid-cols-3 gap-2",children:[a.jsx(C,{options:[{label:"Absen Siang",value:"absen_siang"},{label:"Absen Pagi",value:"absen_pagi"}],value:M.jenis_absen,onChange:e=>E("jenis_absen",e),placeholder:"Jenis Absen",searchable:!1}),a.jsx(C,{options:ta,value:M.status,onChange:e=>E("status",e),placeholder:"Status Absensi",searchable:!1}),a.jsxs(w,{onClick:()=>{_({jenis_absen:"",status:""}),v()},children:[a.jsx(ea,{className:"mr-2 h-4 w-4"}),"Reset Filter"]})]})]}),a.jsx(K,{children:r?a.jsx(ra,{dataSiswa:s,role:d}):a.jsx(Q,{columns:R,data:s.data,links:s.links,path:"laporan.search.mingguan",current_page:s.current_page,per_page:s.per_page,last_page:s.last_page,total:s.total,isJson:!0,handlePageChange:I})})]}):null]})}export{pe as default};
