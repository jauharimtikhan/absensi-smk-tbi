import{r as j,j as a,v as V,A as U,V as N}from"./app-C9tQhv_Z.js";import{D as Y}from"./date-picker-CGWdj_gR.js";import{C as M,a as O,b as $,c as F}from"./card-DShkTWeU.js";import{A as L}from"./AuthenticatedLayout-ChHh_5dT.js";import{S as k}from"./select2-Ilo9BMIQ.js";import{L as g}from"./label-BaBTBNjW.js";import{T as q,a as Q,b as W,c as B,d as v,e as X,f as _}from"./table-CCp73HfD.js";import{B as T}from"./button-form-CWe0OB07.js";import{S as Z}from"./skeleton-CbZi3YVn.js";import aa from"./AttachMapelToSiswa-DTe5XQaC.js";import{u as ea}from"./useToast-Cw97dzwI.js";import{H as sa}from"./theme-provider-B-DTGj4I.js";import{A as la}from"./arrow-left-CuaMkH-P.js";import{S as y}from"./send-horizontal-BCNo4Gb6.js";import"./select-ObIq_07B.js";import"./index-CQA42a1l.js";import"./button-CJTtMwL8.js";import"./index-BdQq_4o_.js";import"./index-C5g0trgJ.js";import"./index-CwGbMlpu.js";import"./index-DFBKEqHs.js";import"./Combination-BC-g0I6C.js";import"./index-BTkG7Wq1.js";import"./index-af218OiE.js";import"./index-DV3kUubK.js";import"./index-lqNe-Rya.js";import"./chevron-down-DThK4zKl.js";import"./check-BZ89noGP.js";import"./chevron-up-DrQ2uUfL.js";import"./calendar-BCXyCexV.js";import"./chevron-left-mLpkzFX_.js";import"./chevron-right-CNF1v_CZ.js";import"./popover-EextctjQ.js";import"./format-BLGyKstx.js";import"./index-DRMvO1dW.js";import"./calendar-D2wCRpjd.js";import"./input-C6ZwSnPh.js";import"./separator-DZph8esR.js";import"./index-SJC72_OY.js";import"./x-C1UzyEuZ.js";import"./dropdown-menu-Byz9-lBz.js";import"./index-DiYJPi1s.js";import"./ellipsis-vertical-B6lyN1bf.js";import"./index-bfOGIxVS.js";import"./loader-circle-CVDOjECe.js";import"./raw-table-IFDfld6q.js";import"./checkbox-CTS-OmBb.js";const R=[{label:"Hadir",value:"hadir"},{label:"Alpa",value:"alpa"},{label:"Izin",value:"izin"},{label:"Sakit",value:"sakit"}],ta=(d,o)=>{const s=V(d),[h,n]=j.useState(),[e,i]=j.useState(!1),[S,t]=j.useState(!1),p=new URLSearchParams(window.location.search);j.useEffect(()=>{!s.data.tanggal&&p.get("tanggal")?s.setData("tanggal",decodeURIComponent(p.get("tanggal")??"")):s.setData("tanggal",new Date().toISOString().split("T")[0]),!s.data.kelas&&p.get("kelas_id")&&s.setData("kelas",decodeURIComponent(p.get("kelas_id")??"")),!s.data.mapel&&p.get("mapel_id")&&s.setData("mapel",decodeURIComponent(p.get("mapel_id")??"")),p.has("mapel_id")&&p.has("kelas_id")&&m(decodeURIComponent(p.get("kelas_id")??""),decodeURIComponent(p.get("mapel_id")??""))},[]);const m=j.useCallback(async(r,f)=>{var x,w;i(!0);try{const b=await window.axios.get(route("absensi.search.siswa",{kelas:r,mapel:f}));b.status===200&&n(b.data.data)}catch(b){b instanceof U&&((x=b.response)==null?void 0:x.status)===422?N.error(((w=b.response.data)==null?void 0:w.message)??"Kode Kelas Tidak Sah"):N.error("Terjadi kesalahan saat mengambil data siswa")}finally{i(!1)}},[]),P=j.useCallback((r,f)=>{const x=s.data.selected_siswa.filter(w=>w.id_siswa!==r);x.push({id_siswa:r,status_absen:f}),s.setData("selected_siswa",x)},[s]),l=j.useCallback(r=>{s.setData("kelas",r),(o==="super-admin"||s.data.mapel)&&m(r,s.data.mapel)},[s,m,o]),u=j.useCallback(r=>{s.setData("mapel",r),(o==="super-admin"||s.data.kelas)&&m(s.data.kelas,r)},[s,m,o]);return{form:s,dataSiswa:h,loadingSearchSiswa:e,attachMapelToSiswaScreen:S,setAttachMapelToSiswaScreen:t,handleGetDataSiswa:m,handleStatusChange:P,handleKelasChange:l,handleMapelChange:u}},ia=({dataSiswa:d,form:o,handleStatusChange:s,selectedKelas:h,role:n})=>a.jsx(M,{className:"mt-4",children:a.jsx(F,{className:"mt-3",children:a.jsx("div",{className:"relative max-h-[300px] overflow-auto rounded border",children:a.jsxs(q,{children:[a.jsxs(Q,{children:["Total Siswa Kelas ",(h==null?void 0:h.label)??"-"," -"," ",d.length," Siswa"]}),a.jsx(W,{children:a.jsxs(B,{className:"sticky top-0 z-50 bg-background shadow border",children:[a.jsx(v,{className:"w-[5%]",children:"Urut"}),a.jsx(v,{className:"w-[100px]",children:"No Induk"}),a.jsx(v,{className:"text-center",children:"Nama"}),a.jsx(v,{className:"w-[10%]",children:"L/P"}),a.jsx(v,{children:"Jurusan"}),a.jsx(v,{children:"Status"})]})}),a.jsx(X,{children:d.map((e,i)=>a.jsx(na,{index:i,siswa:e,handleStatusChange:s,form:o,role:n},e.id))})]})})})}),na=({role:d,handleStatusChange:o,siswa:s,form:h,index:n})=>{var e;return a.jsxs(B,{children:[a.jsx(_,{children:n+1}),a.jsx(_,{children:s.nis}),a.jsx(_,{children:s.nama_lengkap}),a.jsx(_,{children:s.jenis_kelamin||"-"}),a.jsx(_,{children:s.jurusan}),a.jsx(_,{children:a.jsx(k,{options:d==="super-admin"||d==="bk"?[...R,{label:"Telat",value:"telat"}]:R,onChange:i=>o(s.id.toString(),i),value:((e=h.data.selected_siswa.find(i=>i.id_siswa===String(s.id)))==null?void 0:e.status_absen)||"",searchable:!1,placeholder:"Pilih Status Kehadiran Siswa"})})]})},ra=({role:d,kelases:o,mapels:s,users:h,guruData:n,form:e,handleKelasChange:i,handleMapelChange:S})=>a.jsx(M,{children:a.jsxs(F,{className:"mt-3 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Tanggal Absensi"}),a.jsx(Y,{date:e.data.tanggal,mode:"single",selected:new Date(e.data.tanggal),onSelected:t=>e.setData("tanggal",t),placeholder:"Masukan Tanggal Absensi",todayAction:()=>e.setData("tanggal",new Date().toString()),captionLayout:"dropdown"})]}),d==="super-admin"||d==="bk"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Kelas"}),a.jsx(k,{options:o,value:e.data.kelas,onChange:i,placeholder:"Pilih Kelas"}),e.errors.kelas&&a.jsx("span",{className:"text-red-500",children:e.errors.kelas})]}),a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Mata pelajaran"}),a.jsx(k,{options:[{label:"Keseluruhan",value:"keseluruhan"},...s],value:e.data.mapel,onChange:S,placeholder:"Pilih Mata Pelajaran"})]}),!["bk","guru"].includes(d)&&a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Guru Pengajar"}),a.jsx(k,{options:h,value:e.data.user_id,onChange:t=>e.setData("user_id",t),placeholder:"Pilih Guru Pengajar"})]}),a.jsxs("div",{className:"col-span-full",children:[a.jsx(g,{children:"Pilih Jenis Absensi"}),a.jsx(k,{options:[{label:"Keseluruhan",value:"keseluruhan"},{label:"Absen Pagi",value:"absen_pagi"},{label:"Absen Siang",value:"absen_siang"}],value:e.data.jenis_absen,onChange:t=>e.setData("jenis_absen",t),placeholder:"Pilih Jenis Absensi",searchable:!1})]})]}):a.jsxs(a.Fragment,{children:[n.kelas&&n.kelas.length===0?a.jsx("div",{className:"text-red-500",children:"Anda Belum Memiliki Kelas Yang Di Ampu!"}):a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Kelas"}),a.jsx(k,{options:n.kelas&&n.kelas.map(t=>({label:t.nama_kelas,value:t.id})),value:e.data.kelas,onChange:i,placeholder:"Pilih Kelas"}),e.errors.kelas&&a.jsx("span",{className:"text-red-500",children:e.errors.kelas})]}),n.kelas.length===0?a.jsx("div",{className:"text-red-500",children:"Anda Belum Memiliki Mata Pelajaran Yang Di Ampu!"}):a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Mata Pelajaran"}),a.jsx(k,{options:n.mata_pelajarans.map(t=>({label:t.nama_mapel,value:t.id})),value:e.data.mapel,onChange:S,placeholder:"Pilih Mata Pelajaran"}),e.errors.mapel&&a.jsx("span",{className:"text-red-500",children:e.errors.mapel})]}),a.jsxs("div",{children:[a.jsx(g,{children:"Pilih Jenis Absensi"}),a.jsx(k,{options:[{label:"Keseluruhan",value:"keseluruhan"},{label:"Absen Pagi",value:"absen_pagi"},{label:"Absen Siang",value:"absen_siang"}],value:e.data.jenis_absen,onChange:t=>e.setData("jenis_absen",t),placeholder:"Pilih Jenis Absensi",searchable:!1})]})]})]})});function ee({alert:d,kelases:o,mapels:s,auth:h,users:n,guruData:e}){var I;ea(d);const{role:i}=h.user,[S,t]=j.useState([]),[p,m]=j.useState(!1),P={tanggal:"",kelas:"",mapel:"",jenis_absen:"",selected_siswa:[],user_id:""},{form:l,dataSiswa:u,loadingSearchSiswa:r,attachMapelToSiswaScreen:f,setAttachMapelToSiswaScreen:x,handleStatusChange:w,handleKelasChange:b,handleMapelChange:H,handleGetDataSiswa:z}=ta(P,i),J=c=>{c.preventDefault(),l.post(route("absensi.store"))},E=async()=>{var D;const c=l.data.kelas!=="",A=l.data.mapel!=="";if(!c||!A&&!S){N.error("Kode Kelas Atau Kode Mapel Tidak Sah! ");return}m(!0);try{const C=await window.axios.post(route("absensi.attachSiswa"),{mapel_id:l.data.mapel,siswa_ids:S,kelas_id:l.data.kelas});C.status===200&&(N.success(C.data.message),await z(l.data.kelas,l.data.mapel))}catch(C){if(C instanceof U){N.error(((D=C.response)==null?void 0:D.data.message)??"Terjadi Kesalahan!");return}}finally{m(!1)}},G=()=>{const c=l.data.kelas!=="",A=l.data.mapel!=="";return!c&&!A&&!u?null:c&&A&&u&&u.length===0?f?a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx(T,{label:"Kembali",lefticon:a.jsx(la,{}),type:"button",onClick:()=>x(!1),variant:"outline"}),a.jsx(T,{label:"Tambah Siswa Ke Mapel",righticon:a.jsx(y,{}),type:"button",onClick:E,loading:p})]}):a.jsx("div",{className:"flex justify-end",children:a.jsx(T,{label:"Input Data Siswa",righticon:a.jsx(y,{}),type:"button",onClick:()=>x(!0)})}):c&&A&&u&&u.length>0?a.jsx("div",{className:"flex justify-end",children:a.jsx(T,{label:"Simpan Data Absensi",righticon:a.jsx(y,{}),type:"submit",loading:l.processing})}):null},K=(I=s.find(c=>String(c.value)===l.data.mapel))==null?void 0:I.label;return e.kelas&&e.kelas.length===0&&e.mata_pelajarans&&e.mata_pelajarans.length===0&&!["super-admin","bk"].includes(e.role)?a.jsx(L,{title:"Absensi",children:a.jsxs("div",{className:"flex flex-col justify-center items-center space-y-3",children:[a.jsx("div",{className:"p-4 border-red-600 rounded-full border-2 justify-center items-center flex",children:a.jsx(sa,{className:"text-red-500",size:42})}),a.jsx("p",{className:"text-red-500",children:"*Silahkan hubungi staff TU atau Admin, Untuk aktivasi kelas dan mata pelajaran!"})]})}):a.jsx(L,{title:"Absensi",children:a.jsxs("form",{onSubmit:J,className:"grid grid-cols-1 gap-3",children:[a.jsx(ra,{role:i,kelases:o,mapels:s,users:n,guruData:e,form:l,handleKelasChange:b,handleMapelChange:H}),r?a.jsx("div",{className:"flex items-center justify-center",children:a.jsx(Z,{className:"h-[300px] w-full rounded-xl"})}):u&&u.length>0?a.jsx(ia,{dataSiswa:u,form:l,handleStatusChange:w,selectedKelas:o.find(c=>String(c.value)===l.data.kelas),role:i}):f?a.jsx(aa,{id_kelas:Number(l.data.kelas),id_mapel:Number(l.data.mapel),returnData:c=>t(c)}):e.kelas&&e.kelas.length===0&&e.mata_pelajarans&&e.mata_pelajarans.length===0?null:a.jsx(M,{children:a.jsx(O,{className:"my-2",children:a.jsx($,{className:"text-center text-red-500",children:e&&K?`Belum Ada Siswa Di Mata Pelajaran ${K} Ini`:"Silakan pilih kelas dan mata pelajaran terlebih dahulu"})})}),G()]})})}export{ee as default};
